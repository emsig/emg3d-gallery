
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>4. Adjoint-state vs. FD gradient &#8212; emg3d-gallery 1.8.3 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=649a27d8" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css?v=61a4c737" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=87e54e7c" />
    <link rel="stylesheet" type="text/css" href="../../_static/style.css?v=e38f4a5c" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=fe92956f"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'gallery/comparisons/as_vs_fd_gradient';</script>
    <link rel="icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="5. empymod: 1D VTI Laplace-domain" href="1D_VTI_empymod_Laplace.html" />
    <link rel="prev" title="3. SimPEG: 3D with tri-axial anisotropy" href="3D_triaxial_SimPEG.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/emg3d-logo.svg" class="logo__image only-light" alt="emg3d-gallery 1.8.3 documentation - Home"/>
    <script>document.write(`<img src="../../_static/emg3d-logo.svg" class="logo__image only-dark" alt="emg3d-gallery 1.8.3 documentation - Home"/>`);</script>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    Gallery
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../references.html">
    References
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://emg3d.emsig.xyz">
    Documentation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://emsig.xyz">
    emsig
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/emsig/emg3d" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    Gallery
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../references.html">
    References
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://emg3d.emsig.xyz">
    Documentation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://emsig.xyz">
    emsig
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/emsig/emg3d" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../tutorials/index.html">Tutorials</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/minimum_example.html">01. Minimum working example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/mapping.html">02. Model property mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/simulation.html">03. Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/gradient.html">04. Gradient of the misfit function</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/total_vs_ps_field.html">05. Total vs primary/secondary field</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/parameter_tests.html">06. Parameter tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/cli.html">07. Command-line interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/check_calc_domain.html">08. Ensure computation domain is big enough</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/timedomain.html">09. Transient CSEM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/layered.html">10. Layered</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Comparisons</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="1D_VTI_empymod.html">1. empymod: 1D VTI resistivity</a></li>
<li class="toctree-l2"><a class="reference internal" href="2D_triaxial_MARE2DEM.html">2. MARE2DEM: 2D with tri-axial anisotropy</a></li>
<li class="toctree-l2"><a class="reference internal" href="3D_triaxial_SimPEG.html">3. SimPEG: 3D with tri-axial anisotropy</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">4. Adjoint-state vs. FD gradient</a></li>
<li class="toctree-l2"><a class="reference internal" href="1D_VTI_empymod_Laplace.html">5. empymod: 1D VTI Laplace-domain</a></li>
<li class="toctree-l2"><a class="reference internal" href="magnetic_field.html">6. Magnetic field due to an el. source</a></li>
<li class="toctree-l2"><a class="reference internal" href="magnetic_source_el_loop.html">7. Magnetic source using an electric loop</a></li>
<li class="toctree-l2"><a class="reference internal" href="magnetic_source_duality.html">8. Magnetic source using duality</a></li>
<li class="toctree-l2"><a class="reference internal" href="magnetic_permeability.html">9. Magnetic permeability</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../models/index.html">Models</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../models/GemPy-I.html">GemPy-I: <em>Simple Fault Model</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../models/GemPy-II.html">GemPy-II: <em>Perth Basin</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../models/SEG-EAGE_3D_salt_model.html">SEG-EAGE 3D Salt Model</a></li>
</ul>
</details></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">Gallery</a></li>
    
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Comparisons</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">4....</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-gallery-comparisons-as-vs-fd-gradient-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code.</p>
</div>
<section class="sphx-glr-example-title" id="adjoint-state-vs-fd-gradient">
<span id="sphx-glr-gallery-comparisons-as-vs-fd-gradient-py"></span><h1>4. Adjoint-state vs. FD gradient<a class="headerlink" href="#adjoint-state-vs-fd-gradient" title="Link to this heading">#</a></h1>
<p>The <strong>gradient of the misfit function</strong>, as implemented in <cite>emg3d</cite>, uses the
adjoint-state method following <a class="reference internal" href="../../references.html#plmu08" id="id1"><span>[PlMu08]</span></a> (see
<a class="reference external" href="https://emg3d.emsig.xyz/en/stable/api/emg3d.simulations.Simulation.html#emg3d.simulations.Simulation.gradient" title="(in emg3d v1.8.3)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">emg3d.simulations.Simulation.gradient</span></code></a>). The method has the advantage
that it is very fast. However, it can be tricky to implement and it is always
good to verify the implementation against another method.</p>
<p>We compare in this example the adjoint-state gradient to a simple forward
finite-difference gradient. (See <a class="reference internal" href="../tutorials/gradient.html#sphx-glr-gallery-tutorials-gradient-py"><span class="std std-ref">04. Gradient of the misfit function</span></a>
for more details regarding the adjoint-state gradient.)</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">emg3d</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Rectangle</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LogNorm</span><span class="p">,</span> <span class="n">SymLogNorm</span>
</pre></div>
</div>
<section id="create-a-survey-and-a-simple-model">
<h2>1. Create a survey and a simple model<a class="headerlink" href="#create-a-survey-and-a-simple-model" title="Link to this heading">#</a></h2>
<p>Create a simple block model and a survey for the comparison.</p>
<section id="survey">
<h3>Survey<a class="headerlink" href="#survey" title="Link to this heading">#</a></h3>
<p>The survey consists of one source, one receiver, both electric, x-directed
point-dipoles, where the receiver is on the seafloor and the source 50 m
above. Offset is 3.2 km, and acquisition frequency is 1 Hz.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.surveys.Survey.html#emg3d.surveys.Survey" title="emg3d.surveys.Survey" class="sphx-glr-backref-module-emg3d-surveys sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">survey</span></a> <span class="o">=</span> <a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.surveys.Survey.html#emg3d.surveys.Survey" title="emg3d.surveys.Survey" class="sphx-glr-backref-module-emg3d-surveys sphx-glr-backref-type-py-class"><span class="n">emg3d</span><span class="o">.</span><span class="n">surveys</span><span class="o">.</span><span class="n">Survey</span></a><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Gradient Test-Survey&#39;</span><span class="p">,</span>
    <span class="n">sources</span><span class="o">=</span><a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.electrodes.TxElectricDipole.html#emg3d.electrodes.TxElectricDipole" title="emg3d.electrodes.TxElectricDipole" class="sphx-glr-backref-module-emg3d-electrodes sphx-glr-backref-type-py-class"><span class="n">emg3d</span><span class="o">.</span><span class="n">TxElectricDipole</span></a><span class="p">((</span><span class="o">-</span><span class="mi">1600</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1950</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
    <span class="n">receivers</span><span class="o">=</span><a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.electrodes.RxElectricPoint.html#emg3d.electrodes.RxElectricPoint" title="emg3d.electrodes.RxElectricPoint" class="sphx-glr-backref-module-emg3d-electrodes sphx-glr-backref-type-py-class"><span class="n">emg3d</span><span class="o">.</span><span class="n">RxElectricPoint</span></a><span class="p">((</span><span class="mi">1600</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
    <span class="n">frequencies</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">noise_floor</span><span class="o">=</span><span class="mf">1e-15</span><span class="p">,</span>
    <span class="n">relative_error</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="model">
<h3>Model<a class="headerlink" href="#model" title="Link to this heading">#</a></h3>
<p>As <cite>emg3d</cite> internally computes with conductivities we use conductivities to
compare the gradient in its purest implementation. Note that if we define our
model in terms of resistivities or <span class="math notranslate nohighlight">\(\log_{\{e;10\}}(\{\sigma;\rho\})\)</span>,
the gradient would look differently.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a simple block model.</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">hx</span></a> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.array.html#numpy.array" title="numpy.array" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">array</span></a><span class="p">([</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">])</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">hy</span></a> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.array.html#numpy.array" title="numpy.array" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">array</span></a><span class="p">([</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">])</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">hz</span></a> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.array.html#numpy.array" title="numpy.array" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">array</span></a><span class="p">([</span><span class="mf">1800.</span><span class="p">,</span> <span class="mf">200.</span><span class="p">,</span> <span class="mf">200.</span><span class="p">,</span> <span class="mf">200.</span><span class="p">,</span> <span class="mf">300.</span><span class="p">,</span> <span class="mf">300.</span><span class="p">,</span> <span class="mf">2000.</span><span class="p">,</span>  <span class="mf">500.</span><span class="p">])</span>
<a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.meshes.TensorMesh.html#emg3d.meshes.TensorMesh" title="emg3d.meshes.TensorMesh" class="sphx-glr-backref-module-emg3d-meshes sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model_grid</span></a> <span class="o">=</span> <a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.meshes.TensorMesh.html#emg3d.meshes.TensorMesh" title="emg3d.meshes.TensorMesh" class="sphx-glr-backref-module-emg3d-meshes sphx-glr-backref-type-py-class"><span class="n">emg3d</span><span class="o">.</span><span class="n">TensorMesh</span></a><span class="p">(</span>
        <span class="p">[</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">hx</span></a><span class="p">,</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">hy</span></a><span class="p">,</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">hz</span></a><span class="p">],</span> <span class="n">origin</span><span class="o">=</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.array.html#numpy.array" title="numpy.array" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">array</span></a><span class="p">([</span><span class="o">-</span><span class="mi">3000</span><span class="p">,</span> <span class="o">-</span><span class="mi">3000</span><span class="p">,</span> <span class="o">-</span><span class="mi">5000</span><span class="p">]))</span>

<span class="c1"># Initiate model with conductivities of 1 S/m.</span>
<a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.models.Model.html#emg3d.models.Model" title="emg3d.models.Model" class="sphx-glr-backref-module-emg3d-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model</span></a> <span class="o">=</span> <a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.models.Model.html#emg3d.models.Model" title="emg3d.models.Model" class="sphx-glr-backref-module-emg3d-models sphx-glr-backref-type-py-class"><span class="n">emg3d</span><span class="o">.</span><span class="n">Model</span></a><span class="p">(</span>
        <a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.meshes.TensorMesh.html#emg3d.meshes.TensorMesh" title="emg3d.meshes.TensorMesh" class="sphx-glr-backref-module-emg3d-meshes sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model_grid</span></a><span class="p">,</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ones.html#numpy.ones" title="numpy.ones" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">ones</span></a><span class="p">(</span><a href="https://discretize.simpeg.xyz/en/main/api/generated/discretize.TensorMesh.n_cells.html#discretize.TensorMesh.n_cells" title="discretize.TensorMesh.n_cells" class="sphx-glr-backref-module-discretize sphx-glr-backref-type-py-property"><span class="n">model_grid</span><span class="o">.</span><span class="n">n_cells</span></a><span class="p">),</span> <span class="n">mapping</span><span class="o">=</span><span class="s1">&#39;Conductivity&#39;</span><span class="p">)</span>
<a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.models.Model.html#emg3d.models.Model.property_x" title="emg3d.models.Model.property_x" class="sphx-glr-backref-module-emg3d-models sphx-glr-backref-type-py-attribute"><span class="n">model</span><span class="o">.</span><span class="n">property_x</span></a><span class="p">[:,</span> <span class="p">:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-8</span>  <span class="c1"># Add air layer.</span>
<a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.models.Model.html#emg3d.models.Model.property_x" title="emg3d.models.Model.property_x" class="sphx-glr-backref-module-emg3d-models sphx-glr-backref-type-py-attribute"><span class="n">model</span><span class="o">.</span><span class="n">property_x</span></a><span class="p">[:,</span> <span class="p">:,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">3.33</span>  <span class="c1"># Add seawater layer.</span>
<a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.models.Model.html#emg3d.models.Model" title="emg3d.models.Model" class="sphx-glr-backref-module-emg3d-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model_bg</span></a> <span class="o">=</span> <a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.models.Model.html#emg3d.models.Model.copy" title="emg3d.models.Model.copy" class="sphx-glr-backref-module-emg3d-models sphx-glr-backref-type-py-method"><span class="n">model</span><span class="o">.</span><span class="n">copy</span></a><span class="p">()</span>  <span class="c1"># Make a copy for the background model.</span>

<span class="c1"># Add three blocks.</span>
<a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.models.Model.html#emg3d.models.Model.property_x" title="emg3d.models.Model.property_x" class="sphx-glr-backref-module-emg3d-models sphx-glr-backref-type-py-attribute"><span class="n">model</span><span class="o">.</span><span class="n">property_x</span></a><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.02</span>
<a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.models.Model.html#emg3d.models.Model.property_x" title="emg3d.models.Model.property_x" class="sphx-glr-backref-module-emg3d-models sphx-glr-backref-type-py-attribute"><span class="n">model</span><span class="o">.</span><span class="n">property_x</span></a><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.01</span>
<a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.models.Model.html#emg3d.models.Model.property_x" title="emg3d.models.Model.property_x" class="sphx-glr-backref-module-emg3d-models sphx-glr-backref-type-py-attribute"><span class="n">model</span><span class="o">.</span><span class="n">property_x</span></a><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.005</span>
</pre></div>
</div>
</section>
<section id="qc">
<h3>QC<a class="headerlink" href="#qc" title="Link to this heading">#</a></h3>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="https://discretize.simpeg.xyz/en/main/api/generated/discretize.TensorMesh.plot_3d_slicer.html#discretize.TensorMesh.plot_3d_slicer" title="discretize.TensorMesh.plot_3d_slicer" class="sphx-glr-backref-module-discretize sphx-glr-backref-type-py-method"><span class="n">model_grid</span><span class="o">.</span><span class="n">plot_3d_slicer</span></a><span class="p">(</span><a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.models.Model.html#emg3d.models.Model.property_x" title="emg3d.models.Model.property_x" class="sphx-glr-backref-module-emg3d-models sphx-glr-backref-type-py-attribute"><span class="n">model</span><span class="o">.</span><span class="n">property_x</span><span class="o">.</span><span class="n">ravel</span></a><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">),</span> <span class="n">zslice</span><span class="o">=-</span><span class="mi">2900</span><span class="p">,</span>
                          <span class="n">pcolor_opts</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;norm&#39;</span><span class="p">:</span> <span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mf">0.002</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">3.5</span><span class="p">)})</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Conductivity (S/m)&#39;</span><span class="p">)</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">get_children</span><span class="p">()</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">rec_coords</span></a> <span class="o">=</span> <a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.surveys.Survey.html#emg3d.surveys.Survey.receiver_coordinates" title="emg3d.surveys.Survey.receiver_coordinates" class="sphx-glr-backref-module-emg3d-surveys sphx-glr-backref-type-py-method"><span class="n">survey</span><span class="o">.</span><span class="n">receiver_coordinates</span></a><span class="p">()</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">src_coords</span></a> <span class="o">=</span> <a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.surveys.Survey.html#emg3d.surveys.Survey.source_coordinates" title="emg3d.surveys.Survey.source_coordinates" class="sphx-glr-backref-module-emg3d-surveys sphx-glr-backref-type-py-method"><span class="n">survey</span><span class="o">.</span><span class="n">source_coordinates</span></a><span class="p">()</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">rec_coords</span></a><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">rec_coords</span></a><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;bv&#39;</span><span class="p">)</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">rec_coords</span></a><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">rec_coords</span></a><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;bv&#39;</span><span class="p">)</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">rec_coords</span></a><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">rec_coords</span></a><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;bv&#39;</span><span class="p">)</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">src_coords</span></a><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">src_coords</span></a><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;r*&#39;</span><span class="p">)</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">src_coords</span></a><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">src_coords</span></a><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;r*&#39;</span><span class="p">)</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">src_coords</span></a><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">src_coords</span></a><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;r*&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_as_vs_fd_gradient_001.png" srcset="../../_images/sphx_glr_as_vs_fd_gradient_001.png" alt="Conductivity (S/m)" class = "sphx-glr-single-img"/></section>
</section>
<section id="generate-synthetic-data">
<h2>Generate synthetic data<a class="headerlink" href="#generate-synthetic-data" title="Link to this heading">#</a></h2>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Gridding options.</span>
<span class="n">gridding_opts</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;frequency&#39;</span><span class="p">:</span> <a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.surveys.Survey.html#emg3d.surveys.Survey.frequencies" title="emg3d.surveys.Survey.frequencies" class="sphx-glr-backref-module-emg3d-surveys sphx-glr-backref-type-py-attribute"><span class="n">survey</span><span class="o">.</span><span class="n">frequencies</span></a><span class="p">[</span><span class="s1">&#39;f-1&#39;</span><span class="p">],</span>
    <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">3.33</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">3.33</span><span class="p">],</span>
    <span class="s1">&#39;center&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2000</span><span class="p">),</span>
    <span class="s1">&#39;min_width_limits&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="s1">&#39;domain&#39;</span><span class="p">:</span> <span class="p">([</span><span class="o">-</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">3200</span><span class="p">,</span> <span class="o">-</span><span class="mi">2000</span><span class="p">]),</span>
    <span class="s1">&#39;mapping&#39;</span><span class="p">:</span> <a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.maps.MapConductivity.html#emg3d.maps.MapConductivity" title="emg3d.maps.MapConductivity" class="sphx-glr-backref-module-emg3d-maps sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model</span><span class="o">.</span><span class="n">map</span></a><span class="p">,</span>
    <span class="s1">&#39;center_on_edge&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">}</span>

<a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.meshes.TensorMesh.html#emg3d.meshes.TensorMesh" title="emg3d.meshes.TensorMesh" class="sphx-glr-backref-module-emg3d-meshes sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">data_grid</span></a> <span class="o">=</span> <span class="n">emg3d</span><span class="o">.</span><span class="n">construct_mesh</span><span class="p">(</span><span class="o">**</span><span class="n">gridding_opts</span><span class="p">)</span>

<span class="c1"># Define a simulation for the data.</span>
<a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.simulations.Simulation.html#emg3d.simulations.Simulation" title="emg3d.simulations.Simulation" class="sphx-glr-backref-module-emg3d-simulations sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">simulation_data</span></a> <span class="o">=</span> <a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.simulations.Simulation.html#emg3d.simulations.Simulation" title="emg3d.simulations.Simulation" class="sphx-glr-backref-module-emg3d-simulations sphx-glr-backref-type-py-class"><span class="n">emg3d</span><span class="o">.</span><span class="n">simulations</span><span class="o">.</span><span class="n">Simulation</span></a><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Data for Gradient Test&#39;</span><span class="p">,</span>
    <a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.surveys.Survey.html#emg3d.surveys.Survey" title="emg3d.surveys.Survey" class="sphx-glr-backref-module-emg3d-surveys sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">survey</span></a><span class="o">=</span><a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.surveys.Survey.html#emg3d.surveys.Survey" title="emg3d.surveys.Survey" class="sphx-glr-backref-module-emg3d-surveys sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">survey</span></a><span class="p">,</span>
    <a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.models.Model.html#emg3d.models.Model" title="emg3d.models.Model" class="sphx-glr-backref-module-emg3d-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model</span></a><span class="o">=</span><a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.models.Model.html#emg3d.models.Model.interpolate_to_grid" title="emg3d.models.Model.interpolate_to_grid" class="sphx-glr-backref-module-emg3d-models sphx-glr-backref-type-py-method"><span class="n">model</span><span class="o">.</span><span class="n">interpolate_to_grid</span></a><span class="p">(</span><a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.meshes.TensorMesh.html#emg3d.meshes.TensorMesh" title="emg3d.meshes.TensorMesh" class="sphx-glr-backref-module-emg3d-meshes sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">data_grid</span></a><span class="p">),</span>
    <span class="n">gridding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">,</span>  <span class="c1"># Same grid as for input model.</span>
    <span class="n">max_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Simulate the data and store them as observed.</span>
<a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.simulations.Simulation.html#emg3d.simulations.Simulation.compute" title="emg3d.simulations.Simulation.compute" class="sphx-glr-backref-module-emg3d-simulations sphx-glr-backref-type-py-method"><span class="n">simulation_data</span><span class="o">.</span><span class="n">compute</span></a><span class="p">(</span><span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Let&#39;s print the survey to check that the observed data are now set.</span>
<a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.surveys.Survey.html#emg3d.surveys.Survey" title="emg3d.surveys.Survey" class="sphx-glr-backref-module-emg3d-surveys sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">survey</span></a>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Compute efields            0/1  [00:00]
Compute efields  1/1  [00:04]
Compute efields  1/1  [00:04]
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<h3>Survey Gradient Test-Survey</h3><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
html[data-theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt; Size: 92B
Dimensions:    (src: 1, rec: 1, freq: 1)
Coordinates:
  * src        (src) &lt;U6 24B &#x27;TxED-1&#x27;
  * rec        (rec) &lt;U6 24B &#x27;RxEP-1&#x27;
  * freq       (freq) &lt;U3 12B &#x27;f-1&#x27;
Data variables:
    observed   (src, rec, freq) complex128 16B (-1.4531118691576754e-13+9.070...
    synthetic  (src, rec, freq) complex128 16B (-1.4820509840973356e-13+9.919...
Attributes:
    noise_floor:     1e-15
    relative_error:  0.05</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-1384ca62-c50c-4d7d-8212-085d21d13d97' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-1384ca62-c50c-4d7d-8212-085d21d13d97' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>src</span>: 1</li><li><span class='xr-has-index'>rec</span>: 1</li><li><span class='xr-has-index'>freq</span>: 1</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-59d51270-3302-4fd4-8748-4ad5d19bad64' class='xr-section-summary-in' type='checkbox'  checked><label for='section-59d51270-3302-4fd4-8748-4ad5d19bad64' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>src</span></div><div class='xr-var-dims'>(src)</div><div class='xr-var-dtype'>&lt;U6</div><div class='xr-var-preview xr-preview'>&#x27;TxED-1&#x27;</div><input id='attrs-2a5a6f48-335e-4088-b2df-5e92864a9d1c' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-2a5a6f48-335e-4088-b2df-5e92864a9d1c' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-2a9d506d-0cde-423a-a9cd-256d1ececfe1' class='xr-var-data-in' type='checkbox'><label for='data-2a9d506d-0cde-423a-a9cd-256d1ececfe1' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>Sources :</span></dt><dd>TxED-1: TxElectricDipole: 1.0 A;
    center={-1,600.0; 0.0; -1,950.0} m; =0.0, =0.0; l=1.0 m.</dd></dl></div><div class='xr-var-data'><pre>array([&#x27;TxED-1&#x27;], dtype=&#x27;&lt;U6&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>rec</span></div><div class='xr-var-dims'>(rec)</div><div class='xr-var-dtype'>&lt;U6</div><div class='xr-var-preview xr-preview'>&#x27;RxEP-1&#x27;</div><input id='attrs-d9817e6a-7c25-4db2-b6a3-8b1c39d40dc6' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-d9817e6a-7c25-4db2-b6a3-8b1c39d40dc6' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-002efa7e-076c-4c70-9a5c-4392bd48021b' class='xr-var-data-in' type='checkbox'><label for='data-002efa7e-076c-4c70-9a5c-4392bd48021b' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>Receivers :</span></dt><dd>RxEP-1: RxElectricPoint: absolute; complex;
    x=1,600.0 m, y=0.0 m, z=-2,000.0 m, =0.0, =0.0.</dd></dl></div><div class='xr-var-data'><pre>array([&#x27;RxEP-1&#x27;], dtype=&#x27;&lt;U6&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>freq</span></div><div class='xr-var-dims'>(freq)</div><div class='xr-var-dtype'>&lt;U3</div><div class='xr-var-preview xr-preview'>&#x27;f-1&#x27;</div><input id='attrs-a6f73582-7687-4e8a-bb11-5750ef049bdb' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-a6f73582-7687-4e8a-bb11-5750ef049bdb' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-6abb3842-5572-497e-990a-090cadb4a7cc' class='xr-var-data-in' type='checkbox'><label for='data-6abb3842-5572-497e-990a-090cadb4a7cc' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>Frequencies :</span></dt><dd>f-1: 1.0 Hz.</dd></dl></div><div class='xr-var-data'><pre>array([&#x27;f-1&#x27;], dtype=&#x27;&lt;U3&#x27;)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-0b6d245a-b348-4a49-adf9-4be7a02e2e4d' class='xr-section-summary-in' type='checkbox'  checked><label for='section-0b6d245a-b348-4a49-adf9-4be7a02e2e4d' class='xr-section-summary' >Data variables: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>observed</span></div><div class='xr-var-dims'>(src, rec, freq)</div><div class='xr-var-dtype'>complex128</div><div class='xr-var-preview xr-preview'>(-1.4531118691576754e-13+9.07038...</div><input id='attrs-a1ce6d59-99a3-4a35-ac04-8c8281769eb7' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-a1ce6d59-99a3-4a35-ac04-8c8281769eb7' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-44c0f236-119b-4827-9474-7dcbb7edd039' class='xr-var-data-in' type='checkbox'><label for='data-44c0f236-119b-4827-9474-7dcbb7edd039' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[-1.45311187e-13+9.07038052e-14j]]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>synthetic</span></div><div class='xr-var-dims'>(src, rec, freq)</div><div class='xr-var-dtype'>complex128</div><div class='xr-var-preview xr-preview'>(-1.4820509840973356e-13+9.91971...</div><input id='attrs-7258c486-6fb4-4e02-a135-aa47e64ddac9' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-7258c486-6fb4-4e02-a135-aa47e64ddac9' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-eacea0e3-f9d1-4819-9154-8c159222e78f' class='xr-var-data-in' type='checkbox'><label for='data-eacea0e3-f9d1-4819-9154-8c159222e78f' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[-1.48205098e-13+9.91971764e-14j]]])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-161659f9-a242-481b-81ca-032fa6dcfcc2' class='xr-section-summary-in' type='checkbox'  ><label for='section-161659f9-a242-481b-81ca-032fa6dcfcc2' class='xr-section-summary' >Indexes: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>src</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-1e97f456-1b53-4c1c-ba7b-9ad1f540fd4a' class='xr-index-data-in' type='checkbox'/><label for='index-1e97f456-1b53-4c1c-ba7b-9ad1f540fd4a' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;TxED-1&#x27;], dtype=&#x27;object&#x27;, name=&#x27;src&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>rec</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-0bcc8428-a8d9-4987-9eb7-ad54aaf43198' class='xr-index-data-in' type='checkbox'/><label for='index-0bcc8428-a8d9-4987-9eb7-ad54aaf43198' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;RxEP-1&#x27;], dtype=&#x27;object&#x27;, name=&#x27;rec&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>freq</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-8b43897f-55cd-4170-b9f2-7386de5089a5' class='xr-index-data-in' type='checkbox'/><label for='index-8b43897f-55cd-4170-b9f2-7386de5089a5' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;f-1&#x27;], dtype=&#x27;object&#x27;, name=&#x27;freq&#x27;))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-ee444c8f-e02f-4d4c-a1ce-957126be0630' class='xr-section-summary-in' type='checkbox'  checked><label for='section-ee444c8f-e02f-4d4c-a1ce-957126be0630' class='xr-section-summary' >Attributes: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>noise_floor :</span></dt><dd>1e-15</dd><dt><span>relative_error :</span></dt><dd>0.05</dd></dl></div></li></ul></div></div>
</div>
<br />
<br /></section>
<section id="adjoint-state-gradient">
<h2>Adjoint-state gradient<a class="headerlink" href="#adjoint-state-gradient" title="Link to this heading">#</a></h2>
<p>For the actual comparison we use a very coarse mesh. The reason is that we
have to compute an extra forward model for each cell for the forward
finite-difference approximation, so we try to keep that number low (even
though we only do a cross-section, not the entire cube).</p>
<p>Our computational grid has only 16,384 cells, which should be fast enough to
compute the FD gradient of a cross-section in a few minutes. A
cross-section along the survey-line has <span class="math notranslate nohighlight">\(32 \times 11 = 352\)</span> cells, so
we need to compute an extra 352 forward models. (There are 16 cells in z, but
only 11 below the seafloor.)</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Computational grid (min_width 200 instead of 100).</span>
<span class="n">comp_grid_opts</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">gridding_opts</span><span class="p">,</span> <span class="s1">&#39;min_width_limits&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">}</span>
<a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.meshes.TensorMesh.html#emg3d.meshes.TensorMesh" title="emg3d.meshes.TensorMesh" class="sphx-glr-backref-module-emg3d-meshes sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">comp_grid</span></a> <span class="o">=</span> <span class="n">emg3d</span><span class="o">.</span><span class="n">construct_mesh</span><span class="p">(</span><span class="o">**</span><span class="n">comp_grid_opts</span><span class="p">)</span>

<span class="c1"># Interpolate the background model onto the computational grid.</span>
<a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.models.Model.html#emg3d.models.Model" title="emg3d.models.Model" class="sphx-glr-backref-module-emg3d-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">comp_model</span></a> <span class="o">=</span> <a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.models.Model.html#emg3d.models.Model.interpolate_to_grid" title="emg3d.models.Model.interpolate_to_grid" class="sphx-glr-backref-module-emg3d-models sphx-glr-backref-type-py-method"><span class="n">model_bg</span><span class="o">.</span><span class="n">interpolate_to_grid</span></a><span class="p">(</span><a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.meshes.TensorMesh.html#emg3d.meshes.TensorMesh" title="emg3d.meshes.TensorMesh" class="sphx-glr-backref-module-emg3d-meshes sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">comp_grid</span></a><span class="p">)</span>

<span class="c1"># AS gradient simulation.</span>
<a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.simulations.Simulation.html#emg3d.simulations.Simulation" title="emg3d.simulations.Simulation" class="sphx-glr-backref-module-emg3d-simulations sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">simulation_as</span></a> <span class="o">=</span> <a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.simulations.Simulation.html#emg3d.simulations.Simulation" title="emg3d.simulations.Simulation" class="sphx-glr-backref-module-emg3d-simulations sphx-glr-backref-type-py-class"><span class="n">emg3d</span><span class="o">.</span><span class="n">simulations</span><span class="o">.</span><span class="n">Simulation</span></a><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;AS Gradient Test&#39;</span><span class="p">,</span>
    <a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.surveys.Survey.html#emg3d.surveys.Survey" title="emg3d.surveys.Survey" class="sphx-glr-backref-module-emg3d-surveys sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">survey</span></a><span class="o">=</span><a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.surveys.Survey.html#emg3d.surveys.Survey" title="emg3d.surveys.Survey" class="sphx-glr-backref-module-emg3d-surveys sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">survey</span></a><span class="p">,</span>
    <a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.models.Model.html#emg3d.models.Model" title="emg3d.models.Model" class="sphx-glr-backref-module-emg3d-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model</span></a><span class="o">=</span><a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.models.Model.html#emg3d.models.Model" title="emg3d.models.Model" class="sphx-glr-backref-module-emg3d-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">comp_model</span></a><span class="p">,</span>
    <span class="n">gridding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">,</span>  <span class="c1"># Same grid as for input model.</span>
    <span class="n">max_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>    <span class="c1"># For parallel workers, adjust if you have more.</span>
    <span class="n">receiver_interpolation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>  <span class="c1"># For proper adjoint-state gradient</span>
<span class="p">)</span>

<a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.simulations.Simulation.html#emg3d.simulations.Simulation" title="emg3d.simulations.Simulation" class="sphx-glr-backref-module-emg3d-simulations sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">simulation_as</span></a>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<h3>Simulation AS Gradient Test</h3><ul>  <li>Survey Gradient Test-Survey:    1 sources;    1 receivers;    1 frequencies</li>  <li>Model: conductivity; isotropic; 32 x 32 x 16 (16,384)</li>  <li>Gridding: Same grid as for model; 32 x 32 x 16 (16,384)</li></ul>
</div>
<br />
<br /><div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the misfit and the gradient of the misfit.</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">data_misfit</span></a> <span class="o">=</span> <a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.simulations.Simulation.html#emg3d.simulations.Simulation.misfit" title="emg3d.simulations.Simulation.misfit" class="sphx-glr-backref-module-emg3d-simulations sphx-glr-backref-type-py-attribute"><span class="n">simulation_as</span><span class="o">.</span><span class="n">misfit</span></a>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">as_grad</span></a> <span class="o">=</span> <a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.simulations.Simulation.html#emg3d.simulations.Simulation.gradient" title="emg3d.simulations.Simulation.gradient" class="sphx-glr-backref-module-emg3d-simulations sphx-glr-backref-type-py-attribute"><span class="n">simulation_as</span><span class="o">.</span><span class="n">gradient</span></a>

<span class="c1"># Set water and air gradient to NaN for the plots.</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">as_grad</span></a><span class="p">[:,</span> <span class="p">:,</span> <a href="https://discretize.simpeg.xyz/en/main/api/generated/discretize.TensorMesh.cell_centers_z.html#discretize.TensorMesh.cell_centers_z" title="discretize.TensorMesh.cell_centers_z" class="sphx-glr-backref-module-discretize sphx-glr-backref-type-py-property"><span class="n">comp_grid</span><span class="o">.</span><span class="n">cell_centers_z</span></a> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">2000</span><span class="p">]</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/constants.html#numpy.nan" title="numpy.nan" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-data"><span class="n">np</span><span class="o">.</span><span class="n">nan</span></a>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Compute efields            0/1  [00:00]
Compute efields  1/1  [00:00]
Compute efields  1/1  [00:00]

Back-propagate            0/1  [00:00]
Back-propagate  1/1  [00:00]
Back-propagate  1/1  [00:00]
</pre></div>
</div>
</section>
<section id="finite-difference-gradient">
<h2>Finite-Difference gradient<a class="headerlink" href="#finite-difference-gradient" title="Link to this heading">#</a></h2>
<p>To test if the adjoint-state gradient indeed returns the gradient we can
compare it to a one-sided finite-difference approximated gradient as given by</p>
<div class="math notranslate nohighlight">
\[\left(\nabla_p J \left(\textbf{p}\right)\right)_{FD} =
\frac{J(\textbf{p}+\epsilon) - J(\textbf{p})}{\epsilon} \ .\]</div>
<section id="define-a-fct-to-compute-fd-gradient-for-one-cell">
<h3>Define a fct to compute FD gradient for one cell<a class="headerlink" href="#define-a-fct-to-compute-fd-gradient-for-one-cell" title="Link to this heading">#</a></h3>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define epsilon (some small conductivity value, S/m).</span>
<span class="n">epsilon</span> <span class="o">=</span> <span class="mf">0.0001</span>

<span class="c1"># Define the cross-section.</span>
<span class="n">iy</span> <span class="o">=</span> <a href="https://discretize.simpeg.xyz/en/main/api/generated/discretize.TensorMesh.shape_cells.html#discretize.TensorMesh.shape_cells" title="discretize.TensorMesh.shape_cells" class="sphx-glr-backref-module-discretize sphx-glr-backref-type-py-property"><span class="n">comp_grid</span><span class="o">.</span><span class="n">shape_cells</span></a><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span>


<span class="k">def</span> <span class="nf">comp_fd_grad</span><span class="p">(</span><span class="n">ixiz</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute forward-FD gradient for one cell.&quot;&quot;&quot;</span>

    <span class="c1"># Copy the computational model.</span>
    <span class="n">fd_model</span> <span class="o">=</span> <a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.models.Model.html#emg3d.models.Model.copy" title="emg3d.models.Model.copy" class="sphx-glr-backref-module-emg3d-models sphx-glr-backref-type-py-method"><span class="n">comp_model</span><span class="o">.</span><span class="n">copy</span></a><span class="p">()</span>

    <span class="c1"># Add conductivity-epsilon to this (ix, iy, iz) cell.</span>
    <span class="n">fd_model</span><span class="o">.</span><span class="n">property_x</span><span class="p">[</span><span class="n">ixiz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">iy</span><span class="p">,</span> <span class="n">ixiz</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">epsilon</span>

    <span class="c1"># Create a new simulation with this model</span>
    <span class="n">simulation_fd</span> <span class="o">=</span> <a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.simulations.Simulation.html#emg3d.simulations.Simulation" title="emg3d.simulations.Simulation" class="sphx-glr-backref-module-emg3d-simulations sphx-glr-backref-type-py-class"><span class="n">emg3d</span><span class="o">.</span><span class="n">simulations</span><span class="o">.</span><span class="n">Simulation</span></a><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;FD Gradient Test&#39;</span><span class="p">,</span>
        <a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.surveys.Survey.html#emg3d.surveys.Survey" title="emg3d.surveys.Survey" class="sphx-glr-backref-module-emg3d-surveys sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">survey</span></a><span class="o">=</span><a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.surveys.Survey.html#emg3d.surveys.Survey" title="emg3d.surveys.Survey" class="sphx-glr-backref-module-emg3d-surveys sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">survey</span></a><span class="p">,</span> <a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.models.Model.html#emg3d.models.Model" title="emg3d.models.Model" class="sphx-glr-backref-module-emg3d-models sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model</span></a><span class="o">=</span><span class="n">fd_model</span><span class="p">,</span> <span class="n">gridding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">,</span>
        <span class="n">max_workers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">solver_opts</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;verb&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
        <span class="n">receiver_interpolation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>  <span class="c1"># For proper adjoint-state gradient</span>
    <span class="p">)</span>

    <span class="c1"># Switch-of progress bar in this case</span>
    <span class="n">simulation_fd</span><span class="o">.</span><span class="n">_tqdm_opts</span><span class="p">[</span><span class="s1">&#39;disable&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Get misfit</span>
    <span class="n">fd_data_misfit</span> <span class="o">=</span> <span class="n">simulation_fd</span><span class="o">.</span><span class="n">misfit</span>

    <span class="c1"># Return gradient</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">((</span><span class="n">fd_data_misfit</span> <span class="o">-</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">data_misfit</span></a><span class="p">)</span><span class="o">/</span><span class="n">epsilon</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="loop-over-all-required-cells">
<h3>Loop over all required cells<a class="headerlink" href="#loop-over-all-required-cells" title="Link to this heading">#</a></h3>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initiate FD gradient.</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fd_grad</span></a> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.zeros_like.html#numpy.zeros_like" title="numpy.zeros_like" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span></a><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">as_grad</span></a><span class="p">)</span>

<span class="c1"># Get all ix-iz combinations (without air/water).</span>
<span class="n">ixiz</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
    <span class="nb">range</span><span class="p">(</span><a href="https://discretize.simpeg.xyz/en/main/api/generated/discretize.TensorMesh.shape_cells.html#discretize.TensorMesh.shape_cells" title="discretize.TensorMesh.shape_cells" class="sphx-glr-backref-module-discretize sphx-glr-backref-type-py-property"><span class="n">comp_grid</span><span class="o">.</span><span class="n">shape_cells</span></a><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
    <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><a href="https://discretize.simpeg.xyz/en/main/api/generated/discretize.TensorMesh.cell_centers_z.html#discretize.TensorMesh.cell_centers_z" title="discretize.TensorMesh.cell_centers_z" class="sphx-glr-backref-module-discretize sphx-glr-backref-type-py-property"><span class="n">comp_grid</span><span class="o">.</span><span class="n">cell_centers_z</span></a><span class="p">[</span><a href="https://discretize.simpeg.xyz/en/main/api/generated/discretize.TensorMesh.cell_centers_z.html#discretize.TensorMesh.cell_centers_z" title="discretize.TensorMesh.cell_centers_z" class="sphx-glr-backref-module-discretize sphx-glr-backref-type-py-property"><span class="n">comp_grid</span><span class="o">.</span><span class="n">cell_centers_z</span></a> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">2000</span><span class="p">])))</span>
<span class="p">)</span>

<span class="c1"># Wrap it asynchronously</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">emg3d</span><span class="o">.</span><span class="n">_multiprocessing</span><span class="o">.</span><span class="n">process_map</span><span class="p">(</span>
        <span class="n">comp_fd_grad</span><span class="p">,</span>
        <span class="n">ixiz</span><span class="p">,</span>
        <span class="n">max_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>  <span class="c1"># Adjust max worker here!</span>
<span class="p">)</span>

<span class="c1"># Collect result</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">iz</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ixiz</span><span class="p">):</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fd_grad</span></a><span class="p">[</span><span class="n">ix</span><span class="p">,</span> <span class="n">iy</span><span class="p">,</span> <span class="n">iz</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/352 [00:00&lt;?, ?it/s]
  0%|          | 1/352 [00:00&lt;02:50,  2.05it/s]
  1%|         | 5/352 [00:00&lt;00:59,  5.87it/s]
  3%|         | 9/352 [00:01&lt;00:49,  6.95it/s]
  4%|         | 13/352 [00:01&lt;00:46,  7.36it/s]
  5%|         | 17/352 [00:02&lt;00:43,  7.64it/s]
  6%|         | 21/352 [00:02&lt;00:41,  7.91it/s]
  7%|         | 25/352 [00:03&lt;00:40,  8.05it/s]
  8%|         | 29/352 [00:03&lt;00:40,  8.05it/s]
  9%|         | 33/352 [00:04&lt;00:39,  8.10it/s]
 10%|         | 35/352 [00:04&lt;00:34,  9.07it/s]
 11%|         | 37/352 [00:04&lt;00:40,  7.79it/s]
 11%|         | 39/352 [00:04&lt;00:35,  8.77it/s]
 12%|        | 41/352 [00:05&lt;00:41,  7.55it/s]
 12%|        | 43/352 [00:05&lt;00:36,  8.51it/s]
 13%|        | 45/352 [00:05&lt;00:42,  7.15it/s]
 14%|        | 48/352 [00:06&lt;00:31,  9.74it/s]
 14%|        | 50/352 [00:06&lt;00:37,  8.03it/s]
 15%|        | 52/352 [00:06&lt;00:32,  9.26it/s]
 15%|        | 54/352 [00:06&lt;00:38,  7.74it/s]
 16%|        | 56/352 [00:07&lt;00:32,  9.03it/s]
 16%|        | 58/352 [00:07&lt;00:38,  7.58it/s]
 17%|        | 60/352 [00:07&lt;00:32,  8.93it/s]
 18%|        | 62/352 [00:07&lt;00:38,  7.47it/s]
 18%|        | 63/352 [00:08&lt;00:38,  7.45it/s]
 18%|        | 65/352 [00:08&lt;00:40,  7.00it/s]
 19%|        | 67/352 [00:08&lt;00:35,  8.01it/s]
 20%|        | 69/352 [00:08&lt;00:39,  7.23it/s]
 20%|        | 71/352 [00:09&lt;00:36,  7.66it/s]
 21%|        | 73/352 [00:09&lt;00:37,  7.44it/s]
 21%|       | 75/352 [00:09&lt;00:33,  8.38it/s]
 22%|       | 77/352 [00:09&lt;00:38,  7.05it/s]
 22%|       | 79/352 [00:10&lt;00:32,  8.49it/s]
 23%|       | 81/352 [00:10&lt;00:37,  7.26it/s]
 24%|       | 83/352 [00:10&lt;00:31,  8.57it/s]
 24%|       | 85/352 [00:10&lt;00:36,  7.34it/s]
 25%|       | 87/352 [00:11&lt;00:30,  8.71it/s]
 25%|       | 89/352 [00:11&lt;00:36,  7.26it/s]
 26%|       | 91/352 [00:11&lt;00:30,  8.62it/s]
 26%|       | 93/352 [00:11&lt;00:36,  7.12it/s]
 27%|       | 95/352 [00:12&lt;00:29,  8.61it/s]
 28%|       | 97/352 [00:12&lt;00:36,  7.01it/s]
 28%|       | 100/352 [00:12&lt;00:31,  7.99it/s]
 29%|       | 101/352 [00:13&lt;00:35,  7.15it/s]
 30%|       | 104/352 [00:13&lt;00:30,  8.15it/s]
 30%|       | 105/352 [00:13&lt;00:35,  6.88it/s]
 30%|       | 106/352 [00:13&lt;00:34,  7.23it/s]
 31%|       | 108/352 [00:13&lt;00:28,  8.57it/s]
 31%|       | 109/352 [00:14&lt;00:34,  6.96it/s]
 31%|      | 110/352 [00:14&lt;00:33,  7.18it/s]
 32%|      | 112/352 [00:14&lt;00:29,  8.22it/s]
 32%|      | 113/352 [00:14&lt;00:33,  7.11it/s]
 32%|      | 114/352 [00:14&lt;00:33,  7.09it/s]
 33%|      | 116/352 [00:14&lt;00:28,  8.38it/s]
 33%|      | 117/352 [00:15&lt;00:33,  7.04it/s]
 34%|      | 118/352 [00:15&lt;00:31,  7.51it/s]
 34%|      | 120/352 [00:15&lt;00:28,  8.22it/s]
 34%|      | 121/352 [00:15&lt;00:34,  6.69it/s]
 35%|      | 123/352 [00:15&lt;00:27,  8.33it/s]
 35%|      | 124/352 [00:15&lt;00:26,  8.47it/s]
 36%|      | 125/352 [00:16&lt;00:35,  6.48it/s]
 36%|      | 127/352 [00:16&lt;00:28,  7.87it/s]
 37%|      | 129/352 [00:16&lt;00:31,  7.02it/s]
 37%|      | 130/352 [00:16&lt;00:30,  7.30it/s]
 37%|      | 131/352 [00:17&lt;00:32,  6.81it/s]
 38%|      | 133/352 [00:17&lt;00:28,  7.58it/s]
 38%|      | 134/352 [00:17&lt;00:29,  7.51it/s]
 38%|      | 135/352 [00:17&lt;00:29,  7.37it/s]
 39%|      | 137/352 [00:17&lt;00:27,  7.86it/s]
 39%|      | 138/352 [00:17&lt;00:28,  7.56it/s]
 39%|      | 139/352 [00:18&lt;00:28,  7.40it/s]
 40%|      | 141/352 [00:18&lt;00:27,  7.58it/s]
 40%|      | 142/352 [00:18&lt;00:26,  7.82it/s]
 41%|      | 143/352 [00:18&lt;00:28,  7.24it/s]
 41%|      | 145/352 [00:18&lt;00:28,  7.33it/s]
 42%|     | 147/352 [00:19&lt;00:25,  7.93it/s]
 42%|     | 149/352 [00:19&lt;00:27,  7.26it/s]
 43%|     | 151/352 [00:19&lt;00:27,  7.43it/s]
 43%|     | 153/352 [00:19&lt;00:27,  7.12it/s]
 44%|     | 155/352 [00:20&lt;00:24,  7.97it/s]
 45%|     | 157/352 [00:20&lt;00:27,  7.08it/s]
 45%|     | 159/352 [00:20&lt;00:25,  7.69it/s]
 46%|     | 161/352 [00:21&lt;00:26,  7.29it/s]
 46%|     | 163/352 [00:21&lt;00:23,  7.94it/s]
 47%|     | 165/352 [00:21&lt;00:25,  7.48it/s]
 47%|     | 166/352 [00:21&lt;00:24,  7.69it/s]
 47%|     | 167/352 [00:21&lt;00:24,  7.52it/s]
 48%|     | 169/352 [00:22&lt;00:24,  7.34it/s]
 48%|     | 170/352 [00:22&lt;00:24,  7.56it/s]
 49%|     | 171/352 [00:22&lt;00:23,  7.79it/s]
 49%|     | 173/352 [00:22&lt;00:24,  7.40it/s]
 49%|     | 174/352 [00:22&lt;00:23,  7.72it/s]
 50%|     | 175/352 [00:22&lt;00:22,  7.85it/s]
 50%|     | 177/352 [00:23&lt;00:23,  7.51it/s]
 51%|     | 178/352 [00:23&lt;00:22,  7.81it/s]
 51%|     | 179/352 [00:23&lt;00:22,  7.74it/s]
 51%|    | 181/352 [00:23&lt;00:22,  7.46it/s]
 52%|    | 183/352 [00:23&lt;00:22,  7.56it/s]
 53%|    | 185/352 [00:24&lt;00:22,  7.28it/s]
 53%|    | 187/352 [00:24&lt;00:20,  7.91it/s]
 54%|    | 189/352 [00:24&lt;00:22,  7.28it/s]
 54%|    | 191/352 [00:24&lt;00:20,  7.97it/s]
 55%|    | 193/352 [00:25&lt;00:21,  7.33it/s]
 55%|    | 195/352 [00:25&lt;00:20,  7.84it/s]
 56%|    | 197/352 [00:25&lt;00:20,  7.42it/s]
 57%|    | 199/352 [00:25&lt;00:19,  7.69it/s]
 57%|    | 201/352 [00:26&lt;00:20,  7.50it/s]
 58%|    | 203/352 [00:26&lt;00:19,  7.63it/s]
 58%|    | 205/352 [00:26&lt;00:19,  7.48it/s]
 59%|    | 206/352 [00:26&lt;00:19,  7.68it/s]
 59%|    | 207/352 [00:27&lt;00:20,  6.93it/s]
 59%|    | 209/352 [00:27&lt;00:19,  7.27it/s]
 60%|    | 211/352 [00:27&lt;00:18,  7.55it/s]
 61%|    | 213/352 [00:27&lt;00:19,  7.24it/s]
 61%|    | 215/352 [00:28&lt;00:18,  7.28it/s]
 62%|   | 217/352 [00:28&lt;00:17,  7.54it/s]
 62%|   | 219/352 [00:28&lt;00:18,  7.24it/s]
 63%|   | 221/352 [00:28&lt;00:16,  7.80it/s]
 63%|   | 222/352 [00:29&lt;00:16,  7.81it/s]
 63%|   | 223/352 [00:29&lt;00:17,  7.19it/s]
 64%|   | 225/352 [00:29&lt;00:17,  7.41it/s]
 64%|   | 226/352 [00:29&lt;00:16,  7.82it/s]
 64%|   | 227/352 [00:29&lt;00:18,  6.80it/s]
 65%|   | 229/352 [00:30&lt;00:15,  7.73it/s]
 65%|   | 230/352 [00:30&lt;00:16,  7.20it/s]
 66%|   | 231/352 [00:30&lt;00:17,  6.98it/s]
 66%|   | 232/352 [00:30&lt;00:16,  7.44it/s]
 66%|   | 233/352 [00:30&lt;00:15,  7.68it/s]
 66%|   | 234/352 [00:30&lt;00:16,  7.31it/s]
 67%|   | 235/352 [00:30&lt;00:16,  7.00it/s]
 67%|   | 236/352 [00:31&lt;00:15,  7.35it/s]
 68%|   | 238/352 [00:31&lt;00:16,  6.74it/s]
 68%|   | 240/352 [00:31&lt;00:14,  7.69it/s]
 69%|   | 242/352 [00:31&lt;00:16,  6.83it/s]
 69%|   | 244/352 [00:32&lt;00:13,  7.78it/s]
 70%|   | 246/352 [00:32&lt;00:14,  7.08it/s]
 70%|   | 248/352 [00:32&lt;00:13,  7.71it/s]
 71%|   | 250/352 [00:32&lt;00:14,  7.28it/s]
 72%|  | 252/352 [00:33&lt;00:13,  7.36it/s]
 72%|  | 254/352 [00:33&lt;00:13,  7.48it/s]
 72%|  | 255/352 [00:33&lt;00:12,  7.71it/s]
 73%|  | 256/352 [00:33&lt;00:13,  6.99it/s]
 73%|  | 258/352 [00:33&lt;00:12,  7.41it/s]
 74%|  | 259/352 [00:34&lt;00:13,  6.66it/s]
 74%|  | 261/352 [00:34&lt;00:12,  7.46it/s]
 75%|  | 263/352 [00:34&lt;00:12,  6.90it/s]
 75%|  | 265/352 [00:34&lt;00:11,  7.37it/s]
 76%|  | 266/352 [00:35&lt;00:11,  7.76it/s]
 76%|  | 267/352 [00:35&lt;00:12,  6.72it/s]
 76%|  | 269/352 [00:35&lt;00:11,  7.52it/s]
 77%|  | 271/352 [00:35&lt;00:11,  7.13it/s]
 77%|  | 272/352 [00:36&lt;00:11,  6.69it/s]
 78%|  | 274/352 [00:36&lt;00:10,  7.77it/s]
 78%|  | 275/352 [00:36&lt;00:10,  7.49it/s]
 78%|  | 276/352 [00:36&lt;00:11,  6.70it/s]
 79%|  | 277/352 [00:36&lt;00:11,  6.50it/s]
 79%|  | 279/352 [00:36&lt;00:08,  8.13it/s]
 80%|  | 280/352 [00:37&lt;00:10,  6.98it/s]
 80%|  | 281/352 [00:37&lt;00:12,  5.56it/s]
 81%|  | 284/352 [00:37&lt;00:09,  7.50it/s]
 81%|  | 285/352 [00:37&lt;00:09,  7.23it/s]
 81%| | 286/352 [00:37&lt;00:08,  7.52it/s]
 82%| | 288/352 [00:38&lt;00:08,  7.46it/s]
 82%| | 289/352 [00:38&lt;00:08,  7.39it/s]
 82%| | 290/352 [00:38&lt;00:08,  7.71it/s]
 83%| | 292/352 [00:38&lt;00:07,  7.55it/s]
 83%| | 293/352 [00:38&lt;00:08,  7.37it/s]
 84%| | 294/352 [00:38&lt;00:07,  7.69it/s]
 84%| | 296/352 [00:39&lt;00:07,  7.53it/s]
 84%| | 297/352 [00:39&lt;00:08,  6.67it/s]
 85%| | 299/352 [00:39&lt;00:06,  8.38it/s]
 85%| | 300/352 [00:39&lt;00:06,  7.68it/s]
 86%| | 301/352 [00:39&lt;00:07,  6.69it/s]
 86%| | 303/352 [00:40&lt;00:06,  7.85it/s]
 86%| | 304/352 [00:40&lt;00:06,  7.42it/s]
 87%| | 305/352 [00:40&lt;00:07,  6.11it/s]
 87%| | 307/352 [00:40&lt;00:05,  7.96it/s]
 88%| | 308/352 [00:40&lt;00:06,  6.73it/s]
 88%| | 309/352 [00:41&lt;00:06,  6.53it/s]
 88%| | 311/352 [00:41&lt;00:05,  8.15it/s]
 89%| | 312/352 [00:41&lt;00:06,  6.43it/s]
 89%| | 313/352 [00:41&lt;00:05,  6.82it/s]
 89%| | 315/352 [00:41&lt;00:04,  8.13it/s]
 90%| | 316/352 [00:42&lt;00:05,  6.43it/s]
 90%| | 318/352 [00:42&lt;00:04,  8.44it/s]
 91%| | 319/352 [00:42&lt;00:04,  7.49it/s]
 91%| | 320/352 [00:42&lt;00:04,  6.50it/s]
 91%| | 321/352 [00:42&lt;00:04,  7.00it/s]
 92%|| 323/352 [00:42&lt;00:03,  8.05it/s]
 92%|| 324/352 [00:43&lt;00:04,  6.86it/s]
 92%|| 325/352 [00:43&lt;00:03,  7.14it/s]
 93%|| 327/352 [00:43&lt;00:03,  7.92it/s]
 93%|| 328/352 [00:43&lt;00:03,  6.68it/s]
 94%|| 330/352 [00:43&lt;00:02,  8.24it/s]
 94%|| 331/352 [00:44&lt;00:02,  7.56it/s]
 94%|| 332/352 [00:44&lt;00:03,  5.76it/s]
 95%|| 335/352 [00:44&lt;00:02,  8.03it/s]
 95%|| 336/352 [00:44&lt;00:02,  6.12it/s]
 96%|| 339/352 [00:45&lt;00:01,  8.28it/s]
 97%|| 340/352 [00:45&lt;00:01,  6.30it/s]
 97%|| 343/352 [00:45&lt;00:01,  8.43it/s]
 98%|| 344/352 [00:45&lt;00:01,  6.47it/s]
 99%|| 347/352 [00:46&lt;00:00,  8.51it/s]
 99%|| 348/352 [00:46&lt;00:00,  6.38it/s]
100%|| 351/352 [00:46&lt;00:00,  8.29it/s]
100%|| 352/352 [00:47&lt;00:00,  6.79it/s]
100%|| 352/352 [00:47&lt;00:00,  7.48it/s]
</pre></div>
</div>
</section>
<section id="compare-the-two-gradients">
<h3>Compare the two gradients<a class="headerlink" href="#compare-the-two-gradients" title="Link to this heading">#</a></h3>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute NRMSD between AS and FD (%).</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">nrmsd</span></a> <span class="o">=</span> <span class="mi">200</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">as_grad</span></a><span class="o">-</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fd_grad</span></a><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">as_grad</span></a><span class="p">)</span><span class="o">+</span><span class="nb">abs</span><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fd_grad</span></a><span class="p">))</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">nrmsd</span></a><span class="p">[</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fd_grad</span></a> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/constants.html#numpy.nan" title="numpy.nan" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-data"><span class="n">np</span><span class="o">.</span><span class="n">nan</span></a>

<span class="c1"># Compute sign.</span>
<a href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">tiny</span></a> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.finfo.html#numpy.finfo" title="numpy.finfo" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class"><span class="n">np</span><span class="o">.</span><span class="n">finfo</span></a><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><a href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">tiny</span></a>  <span class="c1"># Avoid division by zero.</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">diff_sign</span></a> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">sign</span></a><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">as_grad</span></a><span class="o">/</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.where.html#numpy.where" title="numpy.where" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">where</span></a><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fd_grad</span></a><span class="p">)</span> <span class="o">&lt;</span> <a href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">tiny</span></a><span class="p">,</span> <a href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">tiny</span></a><span class="p">,</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fd_grad</span></a><span class="p">))</span>


<span class="k">def</span> <span class="nf">plot_diff</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">diff</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper routine to show cells of big NRMSD or different sign.&quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><a href="https://discretize.simpeg.xyz/en/main/api/generated/discretize.TensorMesh.h.html#discretize.TensorMesh.h" title="discretize.TensorMesh.h" class="sphx-glr-backref-module-discretize sphx-glr-backref-type-py-property"><span class="n">comp_grid</span><span class="o">.</span><span class="n">h</span></a><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">iz</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><a href="https://discretize.simpeg.xyz/en/main/api/generated/discretize.TensorMesh.h.html#discretize.TensorMesh.h" title="discretize.TensorMesh.h" class="sphx-glr-backref-module-discretize sphx-glr-backref-type-py-property"><span class="n">comp_grid</span><span class="o">.</span><span class="n">h</span></a><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>

            <span class="k">if</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">diff_sign</span></a><span class="p">[</span><span class="n">ix</span><span class="p">,</span> <span class="n">iy</span><span class="p">,</span> <span class="n">iz</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>
                        <span class="n">Rectangle</span><span class="p">(</span>
                            <span class="p">(</span><a href="https://discretize.simpeg.xyz/en/main/api/generated/discretize.TensorMesh.nodes_x.html#discretize.TensorMesh.nodes_x" title="discretize.TensorMesh.nodes_x" class="sphx-glr-backref-module-discretize sphx-glr-backref-type-py-property"><span class="n">comp_grid</span><span class="o">.</span><span class="n">nodes_x</span></a><span class="p">[</span><span class="n">ix</span><span class="p">],</span> <a href="https://discretize.simpeg.xyz/en/main/api/generated/discretize.TensorMesh.nodes_z.html#discretize.TensorMesh.nodes_z" title="discretize.TensorMesh.nodes_z" class="sphx-glr-backref-module-discretize sphx-glr-backref-type-py-property"><span class="n">comp_grid</span><span class="o">.</span><span class="n">nodes_z</span></a><span class="p">[</span><span class="n">iz</span><span class="p">]),</span>
                            <a href="https://discretize.simpeg.xyz/en/main/api/generated/discretize.TensorMesh.h.html#discretize.TensorMesh.h" title="discretize.TensorMesh.h" class="sphx-glr-backref-module-discretize sphx-glr-backref-type-py-property"><span class="n">comp_grid</span><span class="o">.</span><span class="n">h</span></a><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">ix</span><span class="p">],</span> <a href="https://discretize.simpeg.xyz/en/main/api/generated/discretize.TensorMesh.h.html#discretize.TensorMesh.h" title="discretize.TensorMesh.h" class="sphx-glr-backref-module-discretize sphx-glr-backref-type-py-property"><span class="n">comp_grid</span><span class="o">.</span><span class="n">h</span></a><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">iz</span><span class="p">],</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

            <span class="k">if</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">nrmsd</span></a><span class="p">[</span><span class="n">ix</span><span class="p">,</span> <span class="n">iy</span><span class="p">,</span> <span class="n">iz</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">diff</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>
                        <span class="n">Rectangle</span><span class="p">(</span>
                            <span class="p">(</span><a href="https://discretize.simpeg.xyz/en/main/api/generated/discretize.TensorMesh.nodes_x.html#discretize.TensorMesh.nodes_x" title="discretize.TensorMesh.nodes_x" class="sphx-glr-backref-module-discretize sphx-glr-backref-type-py-property"><span class="n">comp_grid</span><span class="o">.</span><span class="n">nodes_x</span></a><span class="p">[</span><span class="n">ix</span><span class="p">],</span> <a href="https://discretize.simpeg.xyz/en/main/api/generated/discretize.TensorMesh.nodes_z.html#discretize.TensorMesh.nodes_z" title="discretize.TensorMesh.nodes_z" class="sphx-glr-backref-module-discretize sphx-glr-backref-type-py-property"><span class="n">comp_grid</span><span class="o">.</span><span class="n">nodes_z</span></a><span class="p">[</span><span class="n">iz</span><span class="p">]),</span>
                            <a href="https://discretize.simpeg.xyz/en/main/api/generated/discretize.TensorMesh.h.html#discretize.TensorMesh.h" title="discretize.TensorMesh.h" class="sphx-glr-backref-module-discretize sphx-glr-backref-type-py-property"><span class="n">comp_grid</span><span class="o">.</span><span class="n">h</span></a><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">ix</span><span class="p">],</span> <a href="https://discretize.simpeg.xyz/en/main/api/generated/discretize.TensorMesh.h.html#discretize.TensorMesh.h" title="discretize.TensorMesh.h" class="sphx-glr-backref-module-discretize sphx-glr-backref-type-py-property"><span class="n">comp_grid</span><span class="o">.</span><span class="n">h</span></a><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">iz</span><span class="p">],</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">set_axis</span><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper routine to adjust subplots.&quot;&quot;&quot;</span>

    <span class="c1"># Show source and receiver.</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">rec_coords</span></a><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">rec_coords</span></a><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;bv&#39;</span><span class="p">)</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">src_coords</span></a><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">src_coords</span></a><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;r*&#39;</span><span class="p">)</span>

    <span class="c1"># x-label.</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Easting&#39;</span><span class="p">)</span>

    <span class="c1"># y-label depending on column.</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Depth&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([])</span>

    <span class="c1"># Set limits.</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">3000</span><span class="p">,</span> <span class="mi">3000</span><span class="p">)</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">4000</span><span class="p">,</span> <span class="o">-</span><span class="mi">1900</span><span class="p">)</span>


<span class="c1"># Plotting options.</span>
<span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="mf">1e-2</span><span class="p">,</span> <span class="mf">1e1</span>
<span class="n">pcolor_opts</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cmap&#39;</span><span class="p">:</span> <span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span>
               <span class="s1">&#39;norm&#39;</span><span class="p">:</span> <span class="n">SymLogNorm</span><span class="p">(</span><span class="n">linthresh</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                  <span class="n">vmin</span><span class="o">=-</span><span class="n">vmax</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)}</span>

<span class="n">fig</span><span class="p">,</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Adjoint-State Gradient</span>
<span class="n">f0</span> <span class="o">=</span> <a href="https://discretize.simpeg.xyz/en/main/api/generated/discretize.TensorMesh.plot_slice.html#discretize.TensorMesh.plot_slice" title="discretize.TensorMesh.plot_slice" class="sphx-glr-backref-module-discretize sphx-glr-backref-type-py-method"><span class="n">comp_grid</span><span class="o">.</span><span class="n">plot_slice</span></a><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">as_grad</span></a><span class="p">,</span> <span class="n">normal</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">ind</span><span class="o">=</span><span class="n">iy</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                          <span class="n">pcolor_opts</span><span class="o">=</span><span class="n">pcolor_opts</span><span class="p">)</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Adjoint-State Gradient&quot;</span><span class="p">)</span>
<span class="n">set_axis</span><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plot_diff</span><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Finite-Difference Gradient</span>
<span class="n">f1</span> <span class="o">=</span> <a href="https://discretize.simpeg.xyz/en/main/api/generated/discretize.TensorMesh.plot_slice.html#discretize.TensorMesh.plot_slice" title="discretize.TensorMesh.plot_slice" class="sphx-glr-backref-module-discretize sphx-glr-backref-type-py-method"><span class="n">comp_grid</span><span class="o">.</span><span class="n">plot_slice</span></a><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fd_grad</span></a><span class="p">,</span> <span class="n">normal</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">ind</span><span class="o">=</span><span class="n">iy</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                          <span class="n">pcolor_opts</span><span class="o">=</span><span class="n">pcolor_opts</span><span class="p">)</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Finite-Difference Gradient&quot;</span><span class="p">)</span>
<span class="n">set_axis</span><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plot_diff</span><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">f0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_as_vs_fd_gradient_002.png" srcset="../../_images/sphx_glr_as_vs_fd_gradient_002.png" alt="Adjoint-State Gradient, Finite-Difference Gradient" class = "sphx-glr-single-img"/><p>Visually the two gradients are almost identical. This is amazing, given that
the adjoint-state gradient requires one (1) extra forward computation for the
entire cube, whereas the finite-difference gradient requires one extra
forward computation for each cell, for this cross-section 352 (!).</p>
<p>There are differences, and they are highlighted:</p>
<blockquote>
<div><ul class="simple">
<li><p>Cells surrounded by a dashed, magenta line: NRMSD is bigger than 1 %.</p></li>
<li><p>Cells surrounded by a black line: The two gradients have different signs.</p></li>
</ul>
</div></blockquote>
<p>These differences only happen where the amplitude of the gradient is very
small, and it therefore blows the NRMSD numerically up (inherit problem of
the relative error when the signal approaches zero).</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="https://emg3d.emsig.xyz/en/stable/api/emg3d.utils.Report.html#emg3d.utils.Report" title="emg3d.utils.Report" class="sphx-glr-backref-module-emg3d-utils sphx-glr-backref-type-py-class"><span class="n">emg3d</span><span class="o">.</span><span class="n">Report</span></a><span class="p">()</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<table style='border: 1.5px solid;'>
  <tr>
     <td style='text-align: center; font-weight: bold; font-size: 1.2em; border: 1px solid;' colspan='6'>Thu Jul 04 15:40:23 2024 CEST</td>
  </tr>
  <tr>
    <td style='text-align: right; border: 1px solid;'>OS</td>
    <td style='text-align: left; border: 1px solid;'>Linux (Ubuntu 22.04)</td>
    <td style='text-align: right; border: 1px solid;'>CPU(s)</td>
    <td style='text-align: left; border: 1px solid;'>16</td>
    <td style='text-align: right; border: 1px solid;'>Machine</td>
    <td style='text-align: left; border: 1px solid;'>x86_64</td>
  </tr>
  <tr>
    <td style='text-align: right; border: 1px solid;'>Architecture</td>
    <td style='text-align: left; border: 1px solid;'>64bit</td>
    <td style='text-align: right; border: 1px solid;'>RAM</td>
    <td style='text-align: left; border: 1px solid;'>31.0 GiB</td>
    <td style='text-align: right; border: 1px solid;'>Environment</td>
    <td style='text-align: left; border: 1px solid;'>Python</td>
  </tr>
  <tr>
    <td style='text-align: right; border: 1px solid;'>File system</td>
    <td style='text-align: left; border: 1px solid;'>ext4</td>
  </tr>
  <tr>
     <td style='text-align: center; border: 1px solid;' colspan='6'>Python 3.12.4 | packaged by conda-forge | (main, Jun 17 2024, 10:23:07) [GCC 12.3.0]</td>
  </tr>
  <tr>
    <td style='text-align: right; border: 1px solid;'>numpy</td>
    <td style='text-align: left; border: 1px solid;'>1.26.4</td>
    <td style='text-align: right; border: 1px solid;'>scipy</td>
    <td style='text-align: left; border: 1px solid;'>1.14.0</td>
    <td style='text-align: right; border: 1px solid;'>numba</td>
    <td style='text-align: left; border: 1px solid;'>0.60.0</td>
  </tr>
  <tr>
    <td style='text-align: right; border: 1px solid;'>emg3d</td>
    <td style='text-align: left; border: 1px solid;'>1.8.3</td>
    <td style='text-align: right; border: 1px solid;'>empymod</td>
    <td style='text-align: left; border: 1px solid;'>2.3.1</td>
    <td style='text-align: right; border: 1px solid;'>xarray</td>
    <td style='text-align: left; border: 1px solid;'>2024.6.1.dev31+g6c2d8c33</td>
  </tr>
  <tr>
    <td style='text-align: right; border: 1px solid;'>discretize</td>
    <td style='text-align: left; border: 1px solid;'>0.10.0</td>
    <td style='text-align: right; border: 1px solid;'>h5py</td>
    <td style='text-align: left; border: 1px solid;'>3.11.0</td>
    <td style='text-align: right; border: 1px solid;'>matplotlib</td>
    <td style='text-align: left; border: 1px solid;'>3.8.4</td>
  </tr>
  <tr>
    <td style='text-align: right; border: 1px solid;'>tqdm</td>
    <td style='text-align: left; border: 1px solid;'>4.66.4</td>
    <td style= border: 1px solid;'></td>
    <td style= border: 1px solid;'></td>
    <td style= border: 1px solid;'></td>
    <td style= border: 1px solid;'></td>
  </tr>
  <tr>
     <td style='text-align: center; border: 1px solid;' colspan='6'>Intel(R) oneAPI Math Kernel Library Version 2023.2-Product Build 20230613 for Intel(R) 64 architecture applications</td>
  </tr>
</table>
</div>
<br />
<br /><p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 53.776 seconds)</p>
<p><strong>Estimated memory usage:</strong>  10 MB</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-gallery-comparisons-as-vs-fd-gradient-py">
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/c61221831ce3faa5f77b450f28d9db92/as_vs_fd_gradient.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">as_vs_fd_gradient.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/a375e9b9fd831c9177081704ac2718dd/as_vs_fd_gradient.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">as_vs_fd_gradient.py</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="3D_triaxial_SimPEG.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">3. SimPEG: 3D with tri-axial anisotropy</p>
      </div>
    </a>
    <a class="right-next"
       href="1D_VTI_empymod_Laplace.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">5. empymod: 1D VTI Laplace-domain</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-survey-and-a-simple-model">1. Create a survey and a simple model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#survey">Survey</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model">Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#qc">QC</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-synthetic-data">Generate synthetic data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adjoint-state-gradient">Adjoint-state gradient</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#finite-difference-gradient">Finite-Difference gradient</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#define-a-fct-to-compute-fd-gradient-for-one-cell">Define a fct to compute FD gradient for one cell</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#loop-over-all-required-cells">Loop over all required cells</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#compare-the-two-gradients">Compare the two gradients</a></li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../../_sources/gallery/comparisons/as_vs_fd_gradient.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
       Copyright 2018-2024, The emsig community.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.3.7.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.4.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>